// worker-bridge.ts
var worker = null;
var readyCallback = null;
(async () => {
  try {
    worker = new Worker(
      "/_content/System.Data.SQLite.Wasm/sqlite-wasm-worker.js",
      { type: "module" }
    );
    worker.onmessage = async (event) => {
      if (event.data.type === "ready") {
        console.log("[Worker Bridge] Worker ready");
        if (readyCallback) {
          readyCallback();
        }
        return;
      }
      if (event.data.type === "error") {
        console.error("[Worker Bridge] Worker error:", event.data.error);
        return;
      }
      if (event.data.id !== void 0) {
        const messageJson = JSON.stringify(event.data);
        try {
          const exports = await globalThis.getDotnetRuntime(0).getAssemblyExports("System.Data.SQLite.Wasm.dll");
          exports.System.Data.SQLite.Wasm.SqliteWasmWorkerBridge.OnWorkerResponse(messageJson);
        } catch (error) {
          console.error("[Worker Bridge] Failed to call C# OnWorkerResponse:", error);
        }
      }
    };
    worker.onerror = (error) => {
      console.error("[Worker Bridge] Worker error event:", error);
    };
  } catch (error) {
    console.error("[Worker Bridge] Failed to create worker:", error);
  }
})();
function sendToWorker(messageJson) {
  if (!worker) {
    throw new Error("Worker not initialized");
  }
  const message = JSON.parse(messageJson);
  worker.postMessage(message);
}
function setReadyCallback(callback) {
  readyCallback = callback;
}
var logger = {
  setLogLevel(level) {
    if (!worker) {
      console.warn("[Worker Bridge] Worker not initialized, cannot set log level");
      return;
    }
    worker.postMessage({
      type: "setLogLevel",
      level
    });
  }
};
globalThis.sqliteWasmWorker = {
  sendToWorker,
  setReadyCallback
};
globalThis.__sqliteWasmLogger = logger;
export {
  logger,
  sendToWorker,
  setReadyCallback
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vVHlwZVNjcmlwdC93b3JrZXItYnJpZGdlLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyIvLyB3b3JrZXItYnJpZGdlLnRzXG4vLyBCcmlkZ2UgYmV0d2VlbiBDIyBKU0ltcG9ydCBhbmQgV2ViIFdvcmtlclxuXG5sZXQgd29ya2VyOiBXb3JrZXIgfCBudWxsID0gbnVsbDtcbmxldCByZWFkeUNhbGxiYWNrOiAoKCkgPT4gdm9pZCkgfCBudWxsID0gbnVsbDtcblxuLy8gSW5pdGlhbGl6ZSB3b3JrZXIgb24gZmlyc3QgaW1wb3J0XG4oYXN5bmMgKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICAgIC8vIENyZWF0ZSB3b3JrZXIgLSBsb2FkIGZyb20gc3RhdGljIGFzc2V0cyBwYXRoXG4gICAgICAgIHdvcmtlciA9IG5ldyBXb3JrZXIoXG4gICAgICAgICAgICAnL19jb250ZW50L1N5c3RlbS5EYXRhLlNRTGl0ZS5XYXNtL3NxbGl0ZS13YXNtLXdvcmtlci5qcycsXG4gICAgICAgICAgICB7IHR5cGU6ICdtb2R1bGUnIH1cbiAgICAgICAgKTtcblxuICAgICAgICAvLyBIYW5kbGUgbWVzc2FnZXMgZnJvbSB3b3JrZXJcbiAgICAgICAgd29ya2VyLm9ubWVzc2FnZSA9IGFzeW5jIChldmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGV2ZW50LmRhdGEudHlwZSA9PT0gJ3JlYWR5Jykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbV29ya2VyIEJyaWRnZV0gV29ya2VyIHJlYWR5Jyk7XG4gICAgICAgICAgICAgICAgaWYgKHJlYWR5Q2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgcmVhZHlDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChldmVudC5kYXRhLnR5cGUgPT09ICdlcnJvcicpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbV29ya2VyIEJyaWRnZV0gV29ya2VyIGVycm9yOicsIGV2ZW50LmRhdGEuZXJyb3IpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRm9yd2FyZCByZXNwb25zZSB0byBDIyB2aWEgSlNFeHBvcnQgbWV0aG9kXG4gICAgICAgICAgICBpZiAoZXZlbnQuZGF0YS5pZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgLy8gU2VyaWFsaXplIHRvIEpTT04gb25jZSwgQyMgZGVzZXJpYWxpemVzIHdpdGggc291cmNlLWdlbmVyYXRlZCBjb250ZXh0XG4gICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZUpzb24gPSBKU09OLnN0cmluZ2lmeShldmVudC5kYXRhKTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBleHBvcnRzID0gYXdhaXQgKGdsb2JhbFRoaXMgYXMgYW55KS5nZXREb3RuZXRSdW50aW1lKDApLmdldEFzc2VtYmx5RXhwb3J0cyhcIlN5c3RlbS5EYXRhLlNRTGl0ZS5XYXNtLmRsbFwiKTtcbiAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5TeXN0ZW0uRGF0YS5TUUxpdGUuV2FzbS5TcWxpdGVXYXNtV29ya2VyQnJpZGdlLk9uV29ya2VyUmVzcG9uc2UobWVzc2FnZUpzb24pO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tXb3JrZXIgQnJpZGdlXSBGYWlsZWQgdG8gY2FsbCBDIyBPbldvcmtlclJlc3BvbnNlOicsIGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgd29ya2VyLm9uZXJyb3IgPSAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tXb3JrZXIgQnJpZGdlXSBXb3JrZXIgZXJyb3IgZXZlbnQ6JywgZXJyb3IpO1xuICAgICAgICB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW1dvcmtlciBCcmlkZ2VdIEZhaWxlZCB0byBjcmVhdGUgd29ya2VyOicsIGVycm9yKTtcbiAgICB9XG59KSgpO1xuXG4vLyBDYWxsZWQgZnJvbSBDIyB0byBzZW5kIHJlcXVlc3QgdG8gd29ya2VyXG5leHBvcnQgZnVuY3Rpb24gc2VuZFRvV29ya2VyKG1lc3NhZ2VKc29uOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoIXdvcmtlcikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1dvcmtlciBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICB9XG5cbiAgICBjb25zdCBtZXNzYWdlID0gSlNPTi5wYXJzZShtZXNzYWdlSnNvbik7XG4gICAgd29ya2VyLnBvc3RNZXNzYWdlKG1lc3NhZ2UpO1xufVxuXG4vLyBDYWxsZWQgZnJvbSBDIyB0byBzZXQgcmVhZHkgY2FsbGJhY2tcbmV4cG9ydCBmdW5jdGlvbiBzZXRSZWFkeUNhbGxiYWNrKGNhbGxiYWNrOiAoKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgcmVhZHlDYWxsYmFjayA9IGNhbGxiYWNrO1xufVxuXG4vLyBMb2dnZXIgQVBJIC0gbWF0Y2hlcyBDIyBTcWxpdGVXYXNtTG9nTGV2ZWwgZW51bVxuZXhwb3J0IGNvbnN0IGxvZ2dlciA9IHtcbiAgICBzZXRMb2dMZXZlbChsZXZlbDogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGlmICghd29ya2VyKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ1tXb3JrZXIgQnJpZGdlXSBXb3JrZXIgbm90IGluaXRpYWxpemVkLCBjYW5ub3Qgc2V0IGxvZyBsZXZlbCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIFNlbmQgbG9nIGxldmVsIGNoYW5nZSB0byB3b3JrZXJcbiAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgIHR5cGU6ICdzZXRMb2dMZXZlbCcsXG4gICAgICAgICAgICBsZXZlbDogbGV2ZWxcbiAgICAgICAgfSk7XG4gICAgfVxufTtcblxuLy8gTWFrZSBmdW5jdGlvbnMgYXZhaWxhYmxlIHRvIEMjIEpTSW1wb3J0XG4oZ2xvYmFsVGhpcyBhcyBhbnkpLnNxbGl0ZVdhc21Xb3JrZXIgPSB7XG4gICAgc2VuZFRvV29ya2VyLFxuICAgIHNldFJlYWR5Q2FsbGJhY2tcbn07XG5cbi8vIEV4cG9zZSBsb2dnZXIgZm9yIEMjIEpTSW1wb3J0XG4oZ2xvYmFsVGhpcyBhcyBhbnkpLl9fc3FsaXRlV2FzbUxvZ2dlciA9IGxvZ2dlcjtcbiJdLAogICJtYXBwaW5ncyI6ICI7QUFHQSxJQUFJLFNBQXdCO0FBQzVCLElBQUksZ0JBQXFDO0FBQUEsQ0FHeEMsWUFBWTtBQUNULE1BQUk7QUFFQSxhQUFTLElBQUk7QUFBQSxNQUNUO0FBQUEsTUFDQSxFQUFFLE1BQU0sU0FBUztBQUFBLElBQ3JCO0FBR0EsV0FBTyxZQUFZLE9BQU8sVUFBVTtBQUNoQyxVQUFJLE1BQU0sS0FBSyxTQUFTLFNBQVM7QUFDN0IsZ0JBQVEsSUFBSSw4QkFBOEI7QUFDMUMsWUFBSSxlQUFlO0FBQ2Ysd0JBQWM7QUFBQSxRQUNsQjtBQUNBO0FBQUEsTUFDSjtBQUVBLFVBQUksTUFBTSxLQUFLLFNBQVMsU0FBUztBQUM3QixnQkFBUSxNQUFNLGlDQUFpQyxNQUFNLEtBQUssS0FBSztBQUMvRDtBQUFBLE1BQ0o7QUFHQSxVQUFJLE1BQU0sS0FBSyxPQUFPLFFBQVc7QUFFN0IsY0FBTSxjQUFjLEtBQUssVUFBVSxNQUFNLElBQUk7QUFDN0MsWUFBSTtBQUNBLGdCQUFNLFVBQVUsTUFBTyxXQUFtQixpQkFBaUIsQ0FBQyxFQUFFLG1CQUFtQiw2QkFBNkI7QUFDOUcsa0JBQVEsT0FBTyxLQUFLLE9BQU8sS0FBSyx1QkFBdUIsaUJBQWlCLFdBQVc7QUFBQSxRQUN2RixTQUFTLE9BQU87QUFDWixrQkFBUSxNQUFNLHVEQUF1RCxLQUFLO0FBQUEsUUFDOUU7QUFBQSxNQUNKO0FBQUEsSUFDSjtBQUVBLFdBQU8sVUFBVSxDQUFDLFVBQVU7QUFDeEIsY0FBUSxNQUFNLHVDQUF1QyxLQUFLO0FBQUEsSUFDOUQ7QUFBQSxFQUVKLFNBQVMsT0FBTztBQUNaLFlBQVEsTUFBTSw0Q0FBNEMsS0FBSztBQUFBLEVBQ25FO0FBQ0osR0FBRztBQUdJLFNBQVMsYUFBYSxhQUEyQjtBQUNwRCxNQUFJLENBQUMsUUFBUTtBQUNULFVBQU0sSUFBSSxNQUFNLHdCQUF3QjtBQUFBLEVBQzVDO0FBRUEsUUFBTSxVQUFVLEtBQUssTUFBTSxXQUFXO0FBQ3RDLFNBQU8sWUFBWSxPQUFPO0FBQzlCO0FBR08sU0FBUyxpQkFBaUIsVUFBNEI7QUFDekQsa0JBQWdCO0FBQ3BCO0FBR08sSUFBTSxTQUFTO0FBQUEsRUFDbEIsWUFBWSxPQUFxQjtBQUM3QixRQUFJLENBQUMsUUFBUTtBQUNULGNBQVEsS0FBSyw4REFBOEQ7QUFDM0U7QUFBQSxJQUNKO0FBRUEsV0FBTyxZQUFZO0FBQUEsTUFDZixNQUFNO0FBQUEsTUFDTjtBQUFBLElBQ0osQ0FBQztBQUFBLEVBQ0w7QUFDSjtBQUdDLFdBQW1CLG1CQUFtQjtBQUFBLEVBQ25DO0FBQUEsRUFDQTtBQUNKO0FBR0MsV0FBbUIscUJBQXFCOyIsCiAgIm5hbWVzIjogW10KfQo=
